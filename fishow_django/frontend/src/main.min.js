"use strict";
console.log('start MAIN');
var waitElement = function(e, t) {
    var n = setTimeout(function a() {
      (n = setTimeout(a, 200)),
        document.querySelector(e) &&
          (clearTimeout(n), t(document.querySelectorAll(e)));
    }, 100);
  },
  getCoords = function(e) {
    var t = e.getBoundingClientRect();
    return { top: t.top + pageYOffset, left: t.left + pageXOffset };
  };
document.body.addEventListener("click", function(e) {
  e.target.classList.contains("rd-nav-link") &&
    localStorage.setItem("active_tab", e.target.innerText),
    e.target.classList.contains("fishow-blog_image__close-button") &&
      e.target.parentNode.parentNode.remove();
});
var activeTab = localStorage.getItem("active_tab");
waitElement(".rd-nav-link", function(e) {
  [].slice.call(e).forEach(function(e) {
    e.innerText === activeTab && e.parentNode.classList.toggle("active");
  });
});
var waitLoadingImage = function(e) {
    waitElement("#fishow-picture".concat(e), function(e) {
      addEventHandler(e[0], "change", function() {
        readURL(this);
      });
    });
  },
  counter = 0,
  global_counter = 0,
  addElementOnPage = function(e, t) {
    var n = 0,
      a = 0;
    waitElement(t, function(t) {
      t[0].addEventListener("click", function() {
        var t = document.createElement("div"),
          o = document.createElement("div");
        if (
          (o.classList.add("form-wrap"),
          t.classList.add("fishow-blog_image__close-button"),
          (t.innerText = "x"),
          o.insertAdjacentElement("afterbegin", t),
          "textarea" === e)
        ) {
          global_counter++, n++;
          var c = document.createElement("label"),
            r = document.createElement("textarea"),
            i = document.createElement("span");
          r.classList.add("form-input"),
            r.classList.add("form-control-has-validation"),
            r.classList.add("form-control-last-child"),
            (r.id = "form-text_".concat(n)),
            r.setAttribute(
              "name",
              "text_".concat(n, "_").concat(global_counter)
            ),
            c.classList.add("form-label"),
            c.classList.add("rd-input-label"),
            c.setAttribute("for", "form-text_".concat(n)),
            i.classList.add("form-validation"),
            o.insertAdjacentElement("beforeend", c),
            o.insertAdjacentElement("beforeend", r),
            o.insertAdjacentElement("beforeend", i);
        } else {
          counter++, a++, global_counter++;
          var l = '<input\n                                    class="form-input"\n                                    id="fishow-picture'
            .concat(
              counter,
              '"\n                                    type="file"\n                                    name="picture_'
            )
            .concat(counter, "_")
            .concat(global_counter, '"\n                            />');
          document
            .querySelector(".fishow_button_picture .fishow_action_btn")
            .insertAdjacentHTML("beforebegin", l),
            waitLoadingImage(counter),
            document.getElementById("fishow-picture".concat(counter)).click();
          var s = document.createElement("img");
          (s.src = "#"),
            (s.width = "500"),
            (s.height = "500"),
            s.setAttribute("data-image", a),
            (s.id = "form-image_".concat(counter)),
            s.setAttribute(
              "name",
              "image_".concat(counter, "_").concat(global_counter)
            ),
            o.classList.add("fishow-blog_image"),
            o.insertAdjacentElement("beforeend", s);
        }
        var d = document.createElement("div");
        d.classList.add("col-md-12"),
          d.classList.add("fishow-content"),
          d.insertAdjacentElement("afterbegin", o);
        var u = document.querySelectorAll(".fishow-content");
        u[u.length - 1].insertAdjacentElement("afterend", d);
      });
    });
  };
addElementOnPage("textarea", ".fishow_button_text .fishow_action_btn"),
  addElementOnPage("picture", ".fishow_button_picture .fishow_action_btn");
var addEventHandler = function(e, t, n) {
    e.addEventListener
      ? e.addEventListener(t, n, !1)
      : e.attachEvent && e.attachEvent("on" + t, n);
  },
  readURL = function(e) {
    if (e.files && e.files[0]) {
      var t = new FileReader();
      (t.onload = function(e) {
        document
          .querySelectorAll(".fishow-blog_image img")
          [
            document.querySelectorAll(".fishow-blog_image img").length - 1
          ].setAttribute("src", e.target.result);
      }),
        t.readAsDataURL(e.files[0]);
    }
  },
  delSpaces = function(e) {
    return e.replace(/\s/g, "");
  };
document.querySelectorAll("[data-vote-status]").forEach(function(e) {
  return console.log(e.getAttribute("data-vote-status"));
});
var handler = function(e, t) {
    var n = ".fishow-votes_up" === t ? "like" : "dislike";
    console.log("like dislike? = ", n);
    var a = parseInt(e.parentNode.querySelector("[data-votes-counter]").id),
      o = e.parentNode
        .querySelector("[data-vote-status]")
        .getAttribute("data-vote-status");
    (o = delSpaces(o)),
      console.log("voteStatus = ", o),
      fetch("http://127.0.0.1:8000/", {
        credentials: "include",
        headers: {
          Accept: "*/*",
          "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
          "X-Requested-With": "XMLHttpRequest",
          Pragma: "no-cache",
          "Cache-Control": "no-cache"
        },
        referrer: "http://127.0.0.1:8000/",
        body: "id_item=".concat(a, "&type_buttons=").concat(n),
        method: "POST",
        mode: "cors"
      }).then(function(e) {
        return (
          500 === e.status
            ? console.error("ошбика запроса")
            : 200 === e.status && (console.table(e), console.log("fine")),
          e
        );
      });
  },
  doVote = function(e) {
    waitElement(e, function(t) {
      [].slice.call(t).forEach(function(t) {
        t.addEventListener("click", function(t) {
          return handler(t.currentTarget.parentNode, e);
        });
      });
    });
  };
doVote(".fishow-votes_down"), doVote(".fishow-votes_up");
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsid2FpdEVsZW1lbnQiLCJlbGVtZW50IiwiY2FsbGJhY2siLCJ0aW1lcklkIiwic2V0VGltZW91dCIsInRpY2siLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGVhclRpbWVvdXQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZ2V0Q29vcmRzIiwiZWxlbSIsImJveCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsInBhZ2VZT2Zmc2V0IiwibGVmdCIsInBhZ2VYT2Zmc2V0IiwiYm9keSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImlubmVyVGV4dCIsInBhcmVudE5vZGUiLCJyZW1vdmUiLCJhY3RpdmVUYWIiLCJnZXRJdGVtIiwiZWxlbWVudHMiLCJzbGljZSIsImNhbGwiLCJmb3JFYWNoIiwiYnV0dG9uIiwidG9nZ2xlIiwid2FpdExvYWRpbmdJbWFnZSIsImltYWdlIiwiY29uY2F0IiwidGhpc0VsZW1lbnQiLCJhZGRFdmVudEhhbmRsZXIiLCJyZWFkVVJMIiwidGhpcyIsImNvdW50ZXIiLCJnbG9iYWxfY291bnRlciIsImFkZEVsZW1lbnRPblBhZ2UiLCJ0eXBlIiwic2VsZWN0b3IiLCJjb3VudGVyVGV4dCIsImNvdW50ZXJJbWFnZSIsImNsb3NlQnV0dG9uIiwiY3JlYXRlRWxlbWVudCIsImZvcm1XcmFwIiwiYWRkIiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwibGFiZWwiLCJ0ZXh0YXJlYSIsInNwYW4iLCJpZCIsInNldEF0dHJpYnV0ZSIsImlucHV0SW1hZ2UiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJnZXRFbGVtZW50QnlJZCIsImNsaWNrIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiLCJjb250YWludGVyIiwiZmlzaG93Q29udGVudCIsImxlbmd0aCIsImV2ZW50VHlwZSIsImhhbmRsZXIiLCJhdHRhY2hFdmVudCIsImlucHV0IiwiZmlsZXMiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiZSIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJkZWxTcGFjZXMiLCJzdHIiLCJyZXBsYWNlIiwiZWxlIiwiY29uc29sZSIsImxvZyIsImdldEF0dHJpYnV0ZSIsInZvdGUiLCJwYXJzZUludCIsInZvdGVTdGF0dXMiLCJmZXRjaCIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsIkFjY2VwdCIsIkNvbnRlbnQtVHlwZSIsIlgtUmVxdWVzdGVkLVdpdGgiLCJQcmFnbWEiLCJDYWNoZS1Db250cm9sIiwicmVmZXJyZXIiLCJtZXRob2QiLCJtb2RlIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiZXJyb3IiLCJ0YWJsZSIsImRvVm90ZSIsInNlbGVjdG9yc0J1dHRvbnMiLCJjdXJyZW50VGFyZ2V0Il0sIm1hcHBpbmdzIjoiQUFBQSxhQUFBLElBQU1BLFlBQWMsU0FBQ0MsRUFBU0MsR0FDMUIsSUFPSUMsRUFBVUMsWUFQRCxTQUFQQyxJQUNGRixFQUFVQyxXQUFXQyxFQUFNLEtBQ3ZCQyxTQUFTQyxjQUFjTixLQUN2Qk8sYUFBYUwsR0FDYkQsRUFBU0ksU0FBU0csaUJBQWlCUixPQUdaLE1BRTdCUyxVQUFZLFNBQUFDLEdBQ2QsSUFBSUMsRUFBTUQsRUFBS0Usd0JBRWYsTUFBTyxDQUNIQyxJQUFLRixFQUFJRSxJQUFNQyxZQUNmQyxLQUFNSixFQUFJSSxLQUFPQyxjQUl6QlgsU0FBU1ksS0FBS0MsaUJBQWlCLFNBQVMsU0FBQUMsR0FDaENBLEVBQU1DLE9BQU9DLFVBQVVDLFNBQVMsZ0JBQ2hDQyxhQUFhQyxRQUFRLGFBQWNMLEVBQU1DLE9BQU9LLFdBRWhETixFQUFNQyxPQUFPQyxVQUFVQyxTQUFTLG9DQUNoQ0gsRUFBTUMsT0FBT00sV0FBV0EsV0FBV0MsWUFHM0MsSUFBTUMsVUFBWUwsYUFBYU0sUUFBUSxjQUN2QzlCLFlBQVksZ0JBQWdCLFNBQUErQixHQUN4QixHQUFHQyxNQUFNQyxL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LFNBQUNDLEdBQ1o3RyxZQUFZNkcsR0FBa0IsU0FBQzlFLEdBQ0wsR0FBR0MsTUFBTUMsS0FBS0YsR0FDdEJHLFNBQVEsU0FBQ0MsR0FDbkJBLEVBQU9oQixpQkFBaUIsU0FBUyxTQUFDQyxHQUFELE9BQVdvRCxRQUFRcEQsRUFBTTBGLGNBQWNuRixXQUFZa0YsYUFJaEdELE9BQU8sc0JBQ1BBLE9BQU8iLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHdhaXRFbGVtZW50ID0gKGVsZW1lbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgY29uc3QgdGljayA9ICgpID0+IHtcbiAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGljaywgMjAwKTtcbiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcklkKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZWxlbWVudCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZXQgdGltZXJJZCA9IHNldFRpbWVvdXQodGljaywgMTAwKTtcbn07XG5jb25zdCBnZXRDb29yZHMgPSBlbGVtID0+IHtcbiAgICBsZXQgYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDogYm94LnRvcCArIHBhZ2VZT2Zmc2V0LFxuICAgICAgICBsZWZ0OiBib3gubGVmdCArIHBhZ2VYT2Zmc2V0XG4gICAgfTtcbn07XG5cbmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50ID0+IHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInJkLW5hdi1saW5rXCIpKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiYWN0aXZlX3RhYlwiLCBldmVudC50YXJnZXQuaW5uZXJUZXh0KTtcbiAgICB9XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJmaXNob3ctYmxvZ19pbWFnZV9fY2xvc2UtYnV0dG9uXCIpKSB7XG4gICAgICAgIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfVxufSk7XG5jb25zdCBhY3RpdmVUYWIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImFjdGl2ZV90YWJcIik7XG53YWl0RWxlbWVudChcIi5yZC1uYXYtbGlua1wiLCBlbGVtZW50cyA9PiB7XG4gICAgW10uc2xpY2UuY2FsbChlbGVtZW50cykuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgICBpZiAoYnV0dG9uLmlubmVyVGV4dCA9PT0gYWN0aXZlVGFiKSB7XG4gICAgICAgICAgICBidXR0b24ucGFyZW50Tm9kZS5jbGFzc0xpc3QudG9nZ2xlKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuY29uc3Qgd2FpdExvYWRpbmdJbWFnZSA9IChpbWFnZSkgPT4ge1xuICAgIHdhaXRFbGVtZW50KGAjZmlzaG93LXBpY3R1cmUke2ltYWdlfWAsICh0aGlzRWxlbWVudCkgPT4ge1xuICAgICAgICBhZGRFdmVudEhhbmRsZXIodGhpc0VsZW1lbnRbMF0sICdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlYWRVUkwodGhpcyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59O1xuXG5sZXQgY291bnRlciA9IDA7XG5sZXQgZ2xvYmFsX2NvdW50ZXIgPSAwO1xuY29uc3QgYWRkRWxlbWVudE9uUGFnZSA9ICh0eXBlLHNlbGVjdG9yKSA9PiB7XG4gICAgbGV0IGNvdW50ZXJUZXh0ID0gMDtcbiAgICBsZXQgY291bnRlckltYWdlID0gMDtcblxuXG4gICAgd2FpdEVsZW1lbnQoc2VsZWN0b3IsIGJ1dHRvbiA9PiB7XG4gICAgICAgIGJ1dHRvblswXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29uc3QgZm9ybVdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgZm9ybVdyYXAuY2xhc3NMaXN0LmFkZCgnZm9ybS13cmFwJyk7XG4gICAgICAgICAgICBjbG9zZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdmaXNob3ctYmxvZ19pbWFnZV9fY2xvc2UtYnV0dG9uJyk7XG4gICAgICAgICAgICBjbG9zZUJ1dHRvbi5pbm5lclRleHQgPSAneCc7XG4gICAgICAgICAgICBmb3JtV3JhcC5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJhZnRlcmJlZ2luXCIsIGNsb3NlQnV0dG9uKTtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAndGV4dGFyZWEnKSB7XG4gICAgICAgICAgICAgICAgZ2xvYmFsX2NvdW50ZXIrKztcbiAgICAgICAgICAgICAgICBjb3VudGVyVGV4dCsrO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblxuICAgICAgICAgICAgICAgIHRleHRhcmVhLmNsYXNzTGlzdC5hZGQoJ2Zvcm0taW5wdXQnKTtcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYS5jbGFzc0xpc3QuYWRkKCdmb3JtLWNvbnRyb2wtaGFzLXZhbGlkYXRpb24nKTtcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYS5jbGFzc0xpc3QuYWRkKCdmb3JtLWNvbnRyb2wtbGFzdC1jaGlsZCcpO1xuICAgICAgICAgICAgICAgIHRleHRhcmVhLmlkID0gYGZvcm0tdGV4dF8ke2NvdW50ZXJUZXh0fWA7XG4gICAgICAgICAgICAgICAgdGV4dGFyZWEuc2V0QXR0cmlidXRlKCduYW1lJywgYHRleHRfJHtjb3VudGVyVGV4dH1fJHtnbG9iYWxfY291bnRlcn1gKTtcblxuXG4gICAgICAgICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZCgnZm9ybS1sYWJlbCcpO1xuICAgICAgICAgICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ3JkLWlucHV0LWxhYmVsJyk7XG4gICAgICAgICAgICAgICAgbGFiZWwuc2V0QXR0cmlidXRlKCdmb3InLGBmb3JtLXRleHRfJHtjb3VudGVyVGV4dH1gKTtcblxuXG4gICAgICAgICAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKCdmb3JtLXZhbGlkYXRpb24nKTtcblxuICAgICAgICAgICAgICAgIGZvcm1XcmFwLmluc2VydEFkamFjZW50RWxlbWVudChcImJlZm9yZWVuZFwiLCBsYWJlbCk7XG4gICAgICAgICAgICAgICAgZm9ybVdyYXAuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYmVmb3JlZW5kXCIsIHRleHRhcmVhKTtcbiAgICAgICAgICAgICAgICBmb3JtV3JhcC5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJiZWZvcmVlbmRcIiwgc3Bhbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvdW50ZXIrKztcbiAgICAgICAgICAgICAgICBjb3VudGVySW1hZ2UrKztcbiAgICAgICAgICAgICAgICBnbG9iYWxfY291bnRlcisrO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRJbWFnZSA9IGA8aW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1pbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD1cImZpc2hvdy1waWN0dXJlJHtjb3VudGVyfVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwiZmlsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPVwicGljdHVyZV8ke2NvdW50ZXJ9XyR7Z2xvYmFsX2NvdW50ZXJ9XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPmA7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpc2hvd19idXR0b25fcGljdHVyZSAuZmlzaG93X2FjdGlvbl9idG4nKS5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmViZWdpblwiLCBpbnB1dEltYWdlKTtcbiAgICAgICAgICAgICAgICB3YWl0TG9hZGluZ0ltYWdlKGNvdW50ZXIpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBmaXNob3ctcGljdHVyZSR7Y291bnRlcn1gKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICAgICAgaW1hZ2Uuc3JjID0gJyMnO1xuICAgICAgICAgICAgICAgIGltYWdlLndpZHRoID0gJzUwMCc7XG4gICAgICAgICAgICAgICAgaW1hZ2UuaGVpZ2h0ID0gJzUwMCc7XG4gICAgICAgICAgICAgICAgLy8gaW1hZ2UuYWx0ID0gYHBpY18ke2NvdW50ZXJJbWFnZX1gO1xuICAgICAgICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1pbWFnZScsIGNvdW50ZXJJbWFnZSk7XG4gICAgICAgICAgICAgICAgaW1hZ2UuaWQgPSBgZm9ybS1pbWFnZV8ke2NvdW50ZXJ9YDtcbiAgICAgICAgICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBgaW1hZ2VfJHtjb3VudGVyfV8ke2dsb2JhbF9jb3VudGVyfWApO1xuXG5cbiAgICAgICAgICAgICAgICBmb3JtV3JhcC5jbGFzc0xpc3QuYWRkKCdmaXNob3ctYmxvZ19pbWFnZScpO1xuICAgICAgICAgICAgICAgIGZvcm1XcmFwLmluc2VydEFkamFjZW50RWxlbWVudChcImJlZm9yZWVuZFwiLCBpbWFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjb250YWludGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb250YWludGVyLmNsYXNzTGlzdC5hZGQoJ2NvbC1tZC0xMicpO1xuICAgICAgICAgICAgY29udGFpbnRlci5jbGFzc0xpc3QuYWRkKCdmaXNob3ctY29udGVudCcpO1xuICAgICAgICAgICAgY29udGFpbnRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJhZnRlcmJlZ2luXCIsIGZvcm1XcmFwKTtcbiAgICAgICAgICAgIGNvbnN0IGZpc2hvd0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZpc2hvdy1jb250ZW50XCIpO1xuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gZmlzaG93Q29udGVudC5sZW5ndGggLSAxO1xuICAgICAgICAgICAgZmlzaG93Q29udGVudFtsZW5ndGhdLmluc2VydEFkamFjZW50RWxlbWVudChcImFmdGVyZW5kXCIsIGNvbnRhaW50ZXIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5cbmFkZEVsZW1lbnRPblBhZ2UoJ3RleHRhcmVhJyxcIi5maXNob3dfYnV0dG9uX3RleHQgLmZpc2hvd19hY3Rpb25fYnRuXCIpO1xuYWRkRWxlbWVudE9uUGFnZSgncGljdHVyZScsXCIuZmlzaG93X2J1dHRvbl9waWN0dXJlIC5maXNob3dfYWN0aW9uX2J0blwiKTtcblxuY29uc3QgYWRkRXZlbnRIYW5kbGVyID0gKGVsZW0sIGV2ZW50VHlwZSwgaGFuZGxlcikgPT4ge1xuICAgIGlmIChlbGVtLmFkZEV2ZW50TGlzdGVuZXIpXG4gICAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciAoZXZlbnRUeXBlLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgZWxzZSBpZiAoZWxlbS5hdHRhY2hFdmVudClcbiAgICAgICAgZWxlbS5hdHRhY2hFdmVudCAoJ29uJyArIGV2ZW50VHlwZSwgaGFuZGxlcik7XG59O1xuY29uc3QgcmVhZFVSTCA9IChpbnB1dCkgPT4ge1xuICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXNob3ctYmxvZ19pbWFnZSBpbWcnKTtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RJbWFnZWxlbmd0aCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXNob3ctYmxvZ19pbWFnZSBpbWcnKS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgbGFzdEltYWdlW2xhc3RJbWFnZWxlbmd0aF0uc2V0QXR0cmlidXRlKCdzcmMnLCBlLnRhcmdldC5yZXN1bHQpOyAvLyBpbWdcbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgIH1cbn07XG5cblxuXG5jb25zdCBkZWxTcGFjZXMgPSAoc3RyKSA9PiBzdHIucmVwbGFjZSgvXFxzL2csICcnKTtcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdm90ZS1zdGF0dXNdJykuZm9yRWFjaCgoZWxlKSA9PiBjb25zb2xlLmxvZyhlbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXZvdGUtc3RhdHVzJykpKTtcbmNvbnN0IGhhbmRsZXIgPSAoZWxlbWVudCwgc2VsZWN0b3IpID0+IHtcbiAgICBjb25zdCB2b3RlID0gc2VsZWN0b3IgPT09ICcuZmlzaG93LXZvdGVzX3VwJyA/ICdsaWtlJyA6ICdkaXNsaWtlJztcbiAgICBjb25zb2xlLmxvZygnbGlrZSBkaXNsaWtlPyA9ICcsIHZvdGUpO1xuICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoZWxlbWVudC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXZvdGVzLWNvdW50ZXJdJykuaWQpO1xuICAgIGxldCB2b3RlU3RhdHVzID0gZWxlbWVudC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXZvdGUtc3RhdHVzXScpLmdldEF0dHJpYnV0ZSgnZGF0YS12b3RlLXN0YXR1cycpO1xuICAgIHZvdGVTdGF0dXMgPSBkZWxTcGFjZXModm90ZVN0YXR1cyk7XG4gICAgY29uc29sZS5sb2coJ3ZvdGVTdGF0dXMgPSAnLCB2b3RlU3RhdHVzKTtcbiAgICBmZXRjaChcImh0dHA6Ly8xMjcuMC4wLjE6ODAwMC9cIiwge1xuICAgICAgICBcImNyZWRlbnRpYWxzXCI6IFwiaW5jbHVkZVwiLFxuICAgICAgICBcImhlYWRlcnNcIjoge1xuICAgICAgICAgICAgXCJBY2NlcHRcIjogXCIqLypcIixcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04XCIsXG4gICAgICAgICAgICBcIlgtUmVxdWVzdGVkLVdpdGhcIjogXCJYTUxIdHRwUmVxdWVzdFwiLFxuICAgICAgICAgICAgXCJQcmFnbWFcIjogXCJuby1jYWNoZVwiLFxuICAgICAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIlxuICAgICAgICB9LFxuICAgICAgICBcInJlZmVycmVyXCI6IFwiaHR0cDovLzEyNy4wLjAuMTo4MDAwL1wiLFxuICAgICAgICBcImJvZHlcIjogYGlkX2l0ZW09JHtpZH0mdHlwZV9idXR0b25zPSR7dm90ZX1gLFxuICAgICAgICBcIm1ldGhvZFwiOiBcIlBPU1RcIixcbiAgICAgICAgXCJtb2RlXCI6IFwiY29yc1wiXG4gICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfQvtGI0LHQuNC60LAg0LfQsNC/0YDQvtGB0LAnKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgY29uc29sZS50YWJsZShyZXNwb25zZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZmluZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KVxufTtcblxuXG5cbmNvbnN0IGRvVm90ZSA9IChzZWxlY3RvcnNCdXR0b25zKSA9PiB7XG4gICAgd2FpdEVsZW1lbnQoc2VsZWN0b3JzQnV0dG9ucywgKGVsZW1lbnRzKSA9PiB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbnNWb3RlVXAgPSBbXS5zbGljZS5jYWxsKGVsZW1lbnRzKTtcbiAgICAgICAgYnV0dG9uc1ZvdGVVcC5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gaGFuZGxlcihldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUsIHNlbGVjdG9yc0J1dHRvbnMpKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuZG9Wb3RlKCcuZmlzaG93LXZvdGVzX2Rvd24nKTtcbmRvVm90ZSgnLmZpc2hvdy12b3Rlc191cCcpO1xuLy8gZnVuY3Rpb24gd2lzaF9mdW5jKGZvcm0saWQsdHlwZV9idXR0b24pXG4vLyB7XG4vLyAgICAgJC5hamF4KFxuLy8gICAgICAgICB7XG4vLyAgICAgICAgICAgICB0eXBlOlwiUE9TVFwiLFxuLy8gICAgICAgICAgICAgdXJsOiBcIlwiLFxuLy8gICAgICAgICAgICAgZGF0YTp7XG4vL1xuLy8gICAgICAgICAgICAgICAgIGlkX2l0ZW06ICQoJyMnK2lkKS52YWwoKSxcbi8vICAgICAgICAgICAgICAgICB0eXBlX2J1dHRvbnMgOiB0eXBlX2J1dHRvblxuLy9cbi8vICAgICAgICAgICAgIH0sXG4vLyAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiggZGF0YSApXG4vLyAgICAgICAgICAgICB7XG4vL1xuLy8gICAgICAgICAgICAgICAgIGlmICh0eXBlX2J1dHRvbj09J2xpa2UnKVxuLy8gICAgICAgICAgICAgICAgIHtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYoICQoJyMnK2lkKydfcmF0aW5nX3RyaWcnKS52YWwoKT09JzAnKVxuLy8gICAgICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytpZCsnX3JhdGluZycpLmh0bWwoIHBhcnNlSW50KCQoJyMnK2lkKydfcmF0aW5nJykudGV4dCgpKSArIDEpO1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycraWQrJ19yYXRpbmdfdHJpZycpLmh0bWwoJCgnIycraWQrJ19yYXRpbmdfdHJpZycpLnZhbCgxKSk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiggJCgnIycraWQrJ19yYXRpbmdfdHJpZycpLnZhbCgpID09Jy0xJylcbi8vICAgICAgICAgICAgICAgICAgICAge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycraWQrJ19yYXRpbmcnKS5odG1sKCBwYXJzZUludCgkKCcjJytpZCsnX3JhdGluZycpLnRleHQoKSkgKyAxKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnK2lkKydfcmF0aW5nX3RyaWcnKS5odG1sKCQoJyMnK2lkKydfcmF0aW5nX3RyaWcnKS52YWwoMSkpO1xuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vL1xuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICBpZiAodHlwZV9idXR0b249PSdkaXNsaWtlJylcbi8vICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGlmKCAkKCcjJytpZCsnX3JhdGluZ190cmlnJykudmFsKCk9PScwJylcbi8vICAgICAgICAgICAgICAgICAgICAge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycraWQrJ19yYXRpbmcnKS5odG1sKCBwYXJzZUludCgkKCcjJytpZCsnX3JhdGluZycpLnRleHQoKSkgLSAxKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnK2lkKydfcmF0aW5nX3RyaWcnKS5odG1sKCQoJyMnK2lkKydfcmF0aW5nX3RyaWcnKS52YWwoLTEpKTtcbi8vICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCAkKCcjJytpZCsnX3JhdGluZ190cmlnJykudmFsKCkgPT0nMScpXG4vLyAgICAgICAgICAgICAgICAgICAgIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnK2lkKydfcmF0aW5nJykuaHRtbCggcGFyc2VJbnQoJCgnIycraWQrJ19yYXRpbmcnKS50ZXh0KCkpIC0gMSk7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytpZCsnX3JhdGluZ190cmlnJykuaHRtbCgkKCcjJytpZCsnX3JhdGluZ190cmlnJykudmFsKC0xKSk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfSk7XG4vL1xuLy8gICAgIHJldHVybiBmYWxzZTtcbi8vXG4vLyB9Il19
